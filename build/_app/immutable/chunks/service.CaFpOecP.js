import{D,F,G}from"./runtime.hdRyageX.js";import{w as K,d as L}from"./index.xNVP18h_.js";function i(t){return{enumerable:!0,value:t}}function T(t){return{enumerable:!0,writable:!0,value:t}}let c={},V=()=>!0,P=()=>({}),k=t=>t,W=(t,e,n,a)=>t.apply(n,a)&&e.apply(n,a),X=(t,e,n,[a,r])=>e.call(n,t.call(n,a,r),r),u=(t,e)=>Object.freeze(Object.create(t,e));function x(t,e,n){return t.reduce((a,r)=>function(...o){return n(a,r,this,o)},e)}function _(t){return u(this,{fn:i(t)})}let O={},l=_.bind(O),C={};_.bind(C);function m(t,e){return e.filter(n=>t.isPrototypeOf(n))}function w(t,e,...n){let a=x(m(C,n).map(o=>o.fn),V,W),r=x(m(O,n).map(o=>o.fn),k,X);return u(this,{from:i(t),to:i(e),guards:i(a),reducers:i(r)})}let E={},I={},s=w.bind(E);w.bind(I,null);function Y(t,e,n){return b(e,t,n,this.immediates)||t}function M(t){let e=new Map;for(let n of t)e.has(n.from)||e.set(n.from,[]),e.get(n.from).push(n);return e}let q={enter:k};function f(...t){let e=m(E,t),n=m(I,t),a={final:i(t.length===0),transitions:i(M(e))};return n.length&&(a.immediates=i(n),a.enter=i(Y)),u(q,a)}let H={enter(t,e,n){let a=this.fn.call(e,e.context,n);return g.isPrototypeOf(a)?u(j,{machine:i(a),transitions:i(this.transitions)}).enter(t,e,n):(a.then(r=>{if(t===e.machine)return e.send({type:"done",data:r})}).catch(r=>{if(t===e.machine)return e.send({type:"error",error:r})}),t)}},j={enter(t,e,n){if(e.child=N(this.machine,a=>{e.onChange(a),e.child==a&&a.machine.state.value.final&&(delete e.child,e.send({type:"done",data:a.context}))},e.context,n),e.child.machine.state.value.final){let a=e.child.context;return delete e.child,b(e,t,{type:"done",data:a},this.transitions.get("done"))}return t}};function J(t,...e){let n=i(M(e));return g.isPrototypeOf(t)?u(j,{machine:i(t),transitions:n}):u(H,{fn:i(t),transitions:n})}let g={get state(){return{name:this.current,value:this.states[this.current]}}};function Q(t,e,n=P){return typeof t!="string"&&(n=e||P,e=t,t=Object.keys(e)[0]),c._create&&c._create(t,e),u(g,{context:i(n),current:i(t),states:i(e)})}function b(t,e,n,a){let{context:r}=t;for(let{to:o,guards:B,reducers:R}of a)if(B(r,n)){t.context=R.call(t,r,n);let y=e.original||e,p=u(y,{current:i(o),original:{value:y}});c._onEnter&&c._onEnter(e,o,t.context,r,n);let z=p.state.value;t.machine=p;let A=z.enter(p,t,n);return t.onChange(t),A}}function U(t,e){let n=e.type||e,{machine:a}=t,{value:r,name:o}=a.state;return r.transitions.has(n)?b(t,a,e,r.transitions.get(n))||a:(c._send&&c._send(n,o),a)}let Z={send(t){U(this,t)}};function N(t,e,n,a){let r=Object.create(Z,{machine:T(t),context:T(t.context(n,a)),onChange:i(e)});return r.send=r.send.bind(r),r.machine=r.machine.state.value.enter(r.machine,r,a),r}function $(t,e){const{subscribe:n,set:a,update:r}=K(N(t,o=>setTimeout(()=>void a(o),0),e));return{subscribe:n,set:a,update:r}}const d={SubmitPage1:"SubmitPage1",SubmitPage2:"SubmitPage2",BackToPage1:"BackToPage1",SubmitPage3:"SubmitPage3",Reset:"Reset"},S={_INIT:J(async t=>(console.log("Log some data to the server",t),"theoretically loaded from server"),s("done","page1",l((t,e)=>({...t,initialData:e.data})))),page1:f(s(d.SubmitPage1,"page2",l((t,e)=>({...t,page1:e.data})))),page2:f(s(d.SubmitPage2,"page3",l((t,e)=>({...t,page2:e.data}))),s(d.BackToPage1,"page1",l(t=>({...t,page1:t.page1?{...t.page1,bar:t.page1.bar+1}:void 0,page2:{baz:!1}})))),page3:f(s(d.SubmitPage3,"finished",l((t,e)=>({...t,page3:e.data})))),finished:f(s(d.Reset,"_INIT",l(()=>({}))))},v=t=>({...t}),h=Symbol();function nt(t=""){if(!D(h)){t===""&&(t=Object.keys(S)[0]);const e=Q(t,S,v),n=$(e,{});F(h,L(n,a=>({current:a.machine.current,context:a.context,submit(r){return a.send(r)}})))}return G(h)}export{d as A,nt as u};
